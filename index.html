<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PipeFlow — Pipeline Designer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="renderer/pipeline.css">
</head>
<body>

  <!-- ════════════════════════════════════
       TOPBAR
  ════════════════════════════════════ -->
  <header id="topbar">

    <!-- Logo -->
    <div class="logo">
      <div class="logo-box">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <rect x="1" y="6" width="14" height="4" rx="1" fill="white" opacity="0.9"/>
          <rect x="5" y="2" width="4" height="12" rx="1" fill="white" opacity="0.5"/>
          <circle cx="3" cy="8" r="2" fill="white"/>
          <circle cx="13" cy="8" r="2" fill="white"/>
        </svg>
      </div>
      <span>PIPEFLOW</span>
      <span class="logo-version">v2</span>
    </div>

    <div class="topbar-sep"></div>

    <!-- Sistem Parametreleri -->
    <div class="sys-params">

      <label class="sys-param">
        <span class="sp-label">Q</span>
        <input
          class="sp-input"
          type="number"
          id="input-Q"
          value="30"
          min="0.1"
          max="10000"
          step="1"
          onchange="setSysConfig('Q_lpm', +this.value)"
        >
        <span class="sp-unit">L/min</span>
      </label>

      <label class="sys-param">
        <span class="sp-label">P<sub>in</sub></span>
        <input
          class="sp-input"
          type="number"
          id="input-Pin"
          value="2.0"
          min="0"
          max="100"
          step="0.1"
          onchange="setSysConfig('P_in_bar', +this.value)"
        >
        <span class="sp-unit">bar</span>
      </label>

      <label class="sys-param">
        <span class="sp-label">T<sub>in</sub></span>
        <input
          class="sp-input"
          type="number"
          id="input-Tin"
          value="20"
          min="0"
          max="150"
          step="1"
          onchange="setSysConfig('T_in_C', +this.value)"
        >
        <span class="sp-unit">°C</span>
      </label>

      <label class="sys-param">
        <span class="sp-label">T<sub>out</sub></span>
        <input
          class="sp-input"
          type="number"
          id="input-Tout"
          value="20"
          min="0"
          max="150"
          step="1"
          onchange="setSysConfig('T_out_C', +this.value)"
        >
        <span class="sp-unit">°C</span>
      </label>

      <div class="topbar-sep"></div>

      <!-- Fluid seçimi -->
      <label class="sys-param">
        <span class="sp-label">Fluid</span>
        <select class="sp-select" id="select-fluid" onchange="setSysConfig('fluid_id', this.value)">
          <option value="water">Su (H₂O)</option>
          <!-- Ek fluidler FluidRegistry'den dinamik doldurulabilir -->
        </select>
      </label>

    </div>

    <div class="topbar-sep"></div>

    <!-- Araç butonları -->
    <div class="topbar-tools">
      <button class="tb-btn active" id="btn-lbl"    onclick="toggleLabels()" title="Toggle Labels">
        <svg width="12" height="12" viewBox="0 0 12 12"><rect x="1" y="4" width="10" height="4" rx="1" fill="none" stroke="currentColor" stroke-width="1"/><line x1="3" y1="6" x2="9" y2="6" stroke="currentColor" stroke-width="1"/></svg>
        Labels
      </button>
      <button class="tb-btn" id="btn-pg" onclick="togglePG()" title="Pressure Gradient Overlay">
        <svg width="12" height="12" viewBox="0 0 12 12"><path d="M1 10 Q3 4 6 5 Q9 6 11 2" fill="none" stroke="currentColor" stroke-width="1.2"/></svg>
        P-Grad
      </button>
      <button class="tb-btn" onclick="zoomFit()" title="Fit to View">
        <svg width="12" height="12" viewBox="0 0 12 12"><rect x="1" y="1" width="4" height="4" rx="0.5" fill="none" stroke="currentColor" stroke-width="1"/><rect x="7" y="7" width="4" height="4" rx="0.5" fill="none" stroke="currentColor" stroke-width="1"/><line x1="5" y1="3" x2="7" y2="3" stroke="currentColor" stroke-width="1"/><line x1="9" y1="5" x2="9" y2="7" stroke="currentColor" stroke-width="1"/></svg>
        Fit
      </button>
    </div>

    <div class="topbar-sep"></div>

    <div class="topbar-tools">
      <button class="tb-btn" onclick="clearLine()" title="Clear all">
        <svg width="12" height="12" viewBox="0 0 12 12"><line x1="2" y1="2" x2="10" y2="10" stroke="currentColor" stroke-width="1.4"/><line x1="10" y1="2" x2="2" y2="10" stroke="currentColor" stroke-width="1.4"/></svg>
        Clear
      </button>
      <button class="tb-btn" onclick="exportJSON()" title="Export JSON">
        <svg width="12" height="12" viewBox="0 0 12 12"><rect x="2" y="1" width="8" height="10" rx="1" fill="none" stroke="currentColor" stroke-width="1"/><line x1="4" y1="4" x2="8" y2="4" stroke="currentColor" stroke-width="1"/><line x1="4" y1="6" x2="8" y2="6" stroke="currentColor" stroke-width="1"/><line x1="4" y1="8" x2="6" y2="8" stroke="currentColor" stroke-width="1"/></svg>
        Export
      </button>
      <button class="tb-btn" id="theme-btn" onclick="toggleTheme()" title="Toggle theme">
        <svg width="12" height="12" viewBox="0 0 12 12"><circle cx="6" cy="6" r="3" fill="currentColor"/><line x1="6" y1="1" x2="6" y2="0" stroke="currentColor" stroke-width="1.4"/><line x1="6" y1="11" x2="6" y2="12" stroke="currentColor" stroke-width="1.4"/><line x1="1" y1="6" x2="0" y2="6" stroke="currentColor" stroke-width="1.4"/><line x1="11" y1="6" x2="12" y2="6" stroke="currentColor" stroke-width="1.4"/><line x1="2.5" y1="2.5" x2="1.8" y2="1.8" stroke="currentColor" stroke-width="1.4"/><line x1="9.5" y1="9.5" x2="10.2" y2="10.2" stroke="currentColor" stroke-width="1.4"/><line x1="9.5" y1="2.5" x2="10.2" y2="1.8" stroke="currentColor" stroke-width="1.4"/><line x1="2.5" y1="9.5" x2="1.8" y2="10.2" stroke="currentColor" stroke-width="1.4"/></svg>
        Theme
      </button>
    </div>

    <!-- Status bar — sağa yaslanmış -->
    <div id="status-bar" data-status="ok">
      <span class="status-dot"></span>
      <span class="status-text">READY</span>
    </div>

  </header>


  <!-- ════════════════════════════════════
       ANA LAYOUT
  ════════════════════════════════════ -->
  <div id="layout">

    <!-- ── SOL KOLON ── -->
    <aside id="col-left">

      <!-- Catalog -->
      <div id="panel-catalog">
        <div class="panel-hdr">
          <div class="panel-hdr-accent" style="background:var(--blue)"></div>
          <span>Components</span>
        </div>
        <div class="panel-scroll" id="cat-body">
          <!-- renderCatalog() tarafından doldurulur -->
        </div>
      </div>

      <!-- Yatay resize -->
      <div class="resize-handler" data-resize="left">
        <div class="resize-grip"></div>
      </div>

      <!-- Properties -->
      <div id="panel-props">
        <div class="panel-hdr">
          <div class="panel-hdr-accent" style="background:var(--accent)"></div>
          <span>Properties</span>
          <button
            class="tb-btn danger"
            id="btn-del-side"
            style="display:none; margin-left:auto;"
            onclick="deleteSelected()"
          >✕ Delete</button>
        </div>
        <div class="panel-scroll" id="prop-body">
          <div id="prop-empty">
            <div class="prop-empty-icon">◈</div>
            <div class="prop-empty-text">SELECT A COMPONENT</div>
          </div>
        </div>
      </div>

    </aside>

    <!-- Dikey kolon resize -->
    <div class="resize-handler" data-resize="col">
      <div class="resize-grip-v"></div>
    </div>

    <!-- ── SAĞ KOLON ── -->
    <main id="col-right">

      <!-- Canvas Paneli -->
      <div id="panel-canvas">

        <!-- Canvas toolbar -->
        <div id="canvas-bar">
          <span class="cv-label">CANVAS</span>
          <div class="cv-sep"></div>
          <span class="cv-info" id="cv-info">Drag components from catalog to start</span>
        </div>

        <!-- SVG Canvas -->
        <div
          id="canvas-scroll"
          ondragover="onDragOver(event)"
          ondrop="onDrop(event)"
          ondragleave="onDragLeave(event)"
        >
          <!-- Nokta grid arka planı CSS ile -->
          <svg id="svg-canvas" xmlns="http://www.w3.org/2000/svg"></svg>

          <div id="empty-hint">
            <div class="hint-icon">
              <svg width="48" height="24" viewBox="0 0 48 24" fill="none">
                <rect x="0" y="9" width="14" height="6" rx="1" fill="#252830"/>
                <rect x="17" y="9" width="14" height="6" rx="1" fill="#252830"/>
                <rect x="34" y="9" width="14" height="6" rx="1" fill="#252830"/>
                <circle cx="2" cy="12" r="3" fill="#3d9ef5" opacity="0.4"/>
                <circle cx="46" cy="12" r="3" fill="#e74c3c" opacity="0.4"/>
                <line x1="14" y1="12" x2="17" y2="12" stroke="#252830" stroke-width="2"/>
                <line x1="31" y1="12" x2="34" y2="12" stroke="#252830" stroke-width="2"/>
              </svg>
            </div>
            <div class="hint-arrow-wrap">
              <div class="hint-arrow">←</div>
              <div class="hint-text">DRAG COMPONENTS<br>FROM CATALOG</div>
            </div>
          </div>
        </div>

      </div>

      <!-- Chart resize -->
      <div class="resize-handler" data-resize="right">
        <div class="resize-grip"></div>
      </div>

      <!-- Chart Paneli -->
      <div id="panel-chart">
        <div class="panel-hdr">
          <div class="panel-hdr-accent" style="background:var(--green)"></div>
          <span>Pressure &amp; Velocity Profile</span>
          <div class="chart-legend">
            <span class="legend-item">
              <span class="legend-line" style="background:var(--blue)"></span>
              P (bar)
            </span>
            <span class="legend-item">
              <span class="legend-line legend-dashed" style="background:var(--green)"></span>
              v (m/s)
            </span>
          </div>
        </div>
        <div id="chart-body">
          <canvas id="chart-canvas"></canvas>
          <div id="chart-empty">ADD COMPONENTS TO SEE THE PROFILE</div>
        </div>
      </div>

    </main>

  </div><!-- /#layout -->

  <!-- ES Module entry point -->
  <script type="module" src="main.js"></script>

</body>
</html>
